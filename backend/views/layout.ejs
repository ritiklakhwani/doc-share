<!DOCTYPE html>
<html>
<head>
  <title>Doc Share</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.css">
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
  <header>
    <h1>One-Time Doc Share</h1>
  </header>

  <main>
    <%- body %>
  </main>

  <script>
    async function connectWallet() {
      try {
        await new Promise(resolve => setTimeout(resolve, 1000))

        const walletChecks = [
          () => window.sui?.connect(),
          () => window.suiWallet?.requestPermissions(),
          () => window.slush?.connect(),
        ]

        for (const check of walletChecks) {
          try {
            const result = await check()
            if (result && result.accounts && result.accounts.length > 0) {
              return result.accounts[0]
            }
          } catch (e) {
            // try next method
          }
        }

        const manualAddress = prompt('Paste your Sui wallet address or cancel for test address:')

        if (manualAddress && manualAddress.trim()) {
          const address = manualAddress.trim()
          if (address.startsWith('0x') && address.length === 66) {
            return address
          }
        }

        // generate test address
        return '0x' + Array(64).fill(0).map(() =>
          Math.floor(Math.random() * 16).toString(16)
        ).join('')

      } catch (error) {
        return '0x' + Array(64).fill(0).map(() =>
          Math.floor(Math.random() * 16).toString(16)
        ).join('')
      }
    }

    // Initialize feather icons when page loads
    document.addEventListener('DOMContentLoaded', function() {
      feather.replace()
    })
  </script>
</body>
</html>